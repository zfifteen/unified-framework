<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prime Geodesic Search Engine</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .control-panel {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        input, select, button {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .export-btn {
            background-color: #28a745;
        }
        .export-btn:hover {
            background-color: #1e7e34;
        }
        .visualization {
            margin: 20px 0;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            overflow: hidden;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .statistics {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Prime Geodesic Search Engine</h1>
            <p>Interactive visualization of modular spiral mapping using θ'(n,k) = φ·((n mod φ)/φ)^k</p>
        </div>
        
        <div class="controls">
            <!-- Generation Controls -->
            <div class="control-panel">
                <h3>Generate Coordinates</h3>
                <div class="control-group">
                    <label for="start">Start Integer:</label>
                    <input type="number" id="start" value="2" min="1">
                </div>
                <div class="control-group">
                    <label for="end">End Integer:</label>
                    <input type="number" id="end" value="102" min="2">
                </div>
                <div class="control-group">
                    <label for="step">Step Size:</label>
                    <input type="number" id="step" value="1" min="1">
                </div>
                <button onclick="generateCoordinates()">Generate Geodesic Coordinates</button>
            </div>
            
            <!-- Visualization Controls -->
            <div class="control-panel">
                <h3>Visualization Options</h3>
                <div class="control-group">
                    <label for="vizType">Visualization Type:</label>
                    <select id="vizType">
                        <option value="3d_spiral">3D Spiral</option>
                        <option value="density_heatmap">Density Heatmap</option>
                        <option value="curvature_analysis">Curvature Analysis</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="colorBy">Color Mapping:</label>
                    <select id="colorBy">
                        <option value="density_enhancement">Density Enhancement</option>
                        <option value="curvature">Curvature</option>
                        <option value="prime_status">Prime Status</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="showClusters" checked> Show Prime Clusters
                    </label>
                </div>
                <button onclick="createVisualization()">Create Visualization</button>
            </div>
            
            <!-- Search Controls -->
            <div class="control-panel">
                <h3>Search & Filter</h3>
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="primesOnly"> Primes Only
                    </label>
                </div>
                <div class="control-group">
                    <label for="curvatureMin">Min Curvature:</label>
                    <input type="number" id="curvatureMin" step="0.1" placeholder="Optional">
                </div>
                <div class="control-group">
                    <label for="curvatureMax">Max Curvature:</label>
                    <input type="number" id="curvatureMax" step="0.1" placeholder="Optional">
                </div>
                <div class="control-group">
                    <label for="densityMin">Min Density Enhancement:</label>
                    <input type="number" id="densityMin" step="0.5" placeholder="Optional">
                </div>
                <button onclick="searchFilter()">Apply Search Filter</button>
            </div>
            
            <!-- Export Controls -->
            <div class="control-panel">
                <h3>Export Data</h3>
                <div class="control-group">
                    <label for="exportFormat">Export Format:</label>
                    <select id="exportFormat">
                        <option value="csv">CSV</option>
                        <option value="json">JSON</option>
                        <option value="npy">NumPy</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="filename">Filename:</label>
                    <input type="text" id="filename" value="geodesic_data" placeholder="filename">
                </div>
                <button class="export-btn" onclick="exportData()">Export Current Data</button>
                <button onclick="getStatistics()">Show Statistics</button>
            </div>
        </div>
        
        <div id="status"></div>
        <div id="statistics"></div>
        <div id="visualization" class="visualization"></div>
    </div>

    <script>
        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${isError ? 'error' : 'success'}">${message}</div>`;
            setTimeout(() => statusDiv.innerHTML = '', 5000);
        }
        
        function showLoading(message) {
            document.getElementById('visualization').innerHTML = `<div class="loading">${message}</div>`;
        }
        
        async function generateCoordinates() {
            const start = parseInt(document.getElementById('start').value);
            const end = parseInt(document.getElementById('end').value);
            const step = parseInt(document.getElementById('step').value);
            
            if (start >= end) {
                showStatus('Start must be less than end', true);
                return;
            }
            
            showLoading('Generating geodesic coordinates...');
            
            try {
                const response = await fetch('/api/generate_coordinates', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ start, end, step })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`Generated ${result.total_points} points (${result.prime_count} primes, ${result.cluster_count} clusters)`);
                    document.getElementById('visualization').innerHTML = '<div class="loading">Click "Create Visualization" to see the results</div>';
                } else {
                    showStatus(result.error, true);
                }
            } catch (error) {
                showStatus('Error generating coordinates: ' + error.message, true);
            }
        }
        
        async function createVisualization() {
            const vizType = document.getElementById('vizType').value;
            const colorBy = document.getElementById('colorBy').value;
            const showClusters = document.getElementById('showClusters').checked;
            
            showLoading('Creating visualization...');
            
            try {
                const response = await fetch('/api/visualize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type: vizType, color_by: colorBy, show_clusters: showClusters })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('visualization').innerHTML = result.plot_html;
                    showStatus('Visualization created successfully');
                } else {
                    showStatus(result.error, true);
                }
            } catch (error) {
                showStatus('Error creating visualization: ' + error.message, true);
            }
        }
        
        async function searchFilter() {
            const criteria = {
                primes_only: document.getElementById('primesOnly').checked
            };
            
            const curvatureMin = document.getElementById('curvatureMin').value;
            const curvatureMax = document.getElementById('curvatureMax').value;
            const densityMin = document.getElementById('densityMin').value;
            
            if (curvatureMin) criteria.curvature_min = parseFloat(curvatureMin);
            if (curvatureMax) criteria.curvature_max = parseFloat(curvatureMax);
            if (densityMin) criteria.density_min = parseFloat(densityMin);
            
            showLoading('Applying search filter...');
            
            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ criteria })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`Filter applied: ${result.total_found} points found (${result.prime_count} primes)`);
                    document.getElementById('visualization').innerHTML = '<div class="loading">Click "Create Visualization" to see filtered results</div>';
                } else {
                    showStatus(result.error, true);
                }
            } catch (error) {
                showStatus('Error applying filter: ' + error.message, true);
            }
        }
        
        async function exportData() {
            const format = document.getElementById('exportFormat').value;
            const filename = document.getElementById('filename').value || 'geodesic_data';
            
            try {
                const response = await fetch('/api/export', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ format, filename })
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${filename}.${format}`;
                    a.click();
                    window.URL.revokeObjectURL(url);
                    showStatus('Data exported successfully');
                } else {
                    const result = await response.json();
                    showStatus(result.error, true);
                }
            } catch (error) {
                showStatus('Error exporting data: ' + error.message, true);
            }
        }
        
        async function getStatistics() {
            try {
                const response = await fetch('/api/statistics');
                const result = await response.json();
                
                if (result.success) {
                    const stats = result.statistics;
                    const statsHtml = `
                        <div class="statistics">
                            <h3>Statistical Analysis</h3>
                            <p><strong>Total Points:</strong> ${stats.summary.total_points}</p>
                            <p><strong>Primes:</strong> ${stats.summary.prime_count} (${(stats.summary.prime_ratio * 100).toFixed(2)}%)</p>
                            <p><strong>Prime Clusters:</strong> ${stats.clustering.cluster_count}</p>
                            <p><strong>Mean Density Enhancement:</strong> ${stats.density_enhancement.mean_enhancement.toFixed(2)}%</p>
                            <p><strong>Average Curvature (Primes):</strong> ${stats.curvature_analysis.prime_curvature_mean.toFixed(4)}</p>
                            <p><strong>Average Curvature (Composites):</strong> ${stats.curvature_analysis.composite_curvature_mean.toFixed(4)}</p>
                            <p><strong>Validation Target:</strong> ${stats.validation_metrics.expected_prime_enhancement}% (Expected)</p>
                            <p><strong>Achieved Enhancement:</strong> ${stats.validation_metrics.achieved_enhancement.toFixed(2)}%</p>
                        </div>
                    `;
                    document.getElementById('statistics').innerHTML = statsHtml;
                    showStatus('Statistics updated');
                } else {
                    showStatus(result.error, true);
                }
            } catch (error) {
                showStatus('Error getting statistics: ' + error.message, true);
            }
        }
        
        // Auto-generate initial data on page load
        window.onload = function() {
            generateCoordinates();
        };
    </script>
</body>
</html>